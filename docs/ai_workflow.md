# AI Integration Workflow

## Overview
The AI integration aims to streamline the support process by assisting administrators with automated response suggestions and intelligent ticket analysis.

## Workflow Phases

### Phase 1: AI Copilot for Admins (Suggested Replies)
**Goal:** Reduce response time by providing admins with a draft response generated by AI.

1.  **Trigger:** Client creates a new ticket or replies to an existing one.
2.  **Processing:**
    *   The system dispatches a background job (`GenerateAIResponse`).
    *   The job sends the ticket history and current message to the AI Provider (OpenAI/Gemini).
    *   **System Prompt:** "You are a professional customer support agent for [Company Name]. Analyze the following ticket and draft a helpful, empathetic, and concise response."
3.  **Output:**
    *   The AI generated response is saved to the database (e.g., `ai_draft_response` column or a separate table).
4.  **UI Integration:**
    *   On the **Admin Ticket Detail** page, a new section "AI Suggested Reply" appears above the reply box.
    *   Admin can click "Use Suggestion" to copy the text into the reply box, edit it, and send.

### Phase 2: Intelligent Triage (Auto-Categorization & Priority)
**Goal:** Automatically organize tickets to ensure critical issues are handled first.

1.  **Trigger:** Ticket creation.
2.  **Processing:**
    *   AI analyzes the `description` and `subject`.
    *   AI determines:
        *   **Sentiment:** (Positive, Neutral, Negative, Frustrated)
        *   **Urgency:** (Low, Medium, High, Critical)
        *   **Category:** (Technical, Billing, Feature, etc.)
3.  **Action:**
    *   System updates the ticket's `impact` and `category` if they differ significantly from user selection (or flags them for review).
    *   High-urgency tickets trigger an immediate alert to admins.

### Phase 3: Knowledge Base RAG (Retrieval-Augmented Generation)
**Goal:** Provide accurate answers based on specific company documentation.

1.  **Setup:**
    *   Upload PDF/Markdown documentation to a vector database (e.g., Pinecone, Weaviate, or local pgvector).
2.  **Processing:**
    *   When a question is asked, the system searches the vector DB for relevant context.
    *   The AI constructs an answer using *only* the provided context to avoid hallucinations.

## Technical Architecture

1.  **Service Class:** `App\Services\AIService`
    *   Methods: `generateResponse($ticket)`, `analyzeSentiment($text)`.
2.  **Queue System:** Use Laravel Queues (Redis/Database) to handle API requests asynchronously.
3.  **Database Changes:**
    *   Add `ai_suggestion` column to `tickets` table.
    *   Add `sentiment_score` column to `tickets` table.

## Recommended Tech Stack
*   **LLM Provider:** OpenAI (GPT-4o-mini) or Google Gemini (Flash 1.5) for speed and cost-efficiency.
*   **Client:** `openai-php/laravel` or custom HTTP client.
